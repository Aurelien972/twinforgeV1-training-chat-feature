# Coach Endurance - Spécification Complète

**Version:** 1.0.0
**Date:** October 2025
**Status:** Production Ready

---

## Vue d'Ensemble

Le Coach Endurance est un agent IA spécialisé dans la programmation d'entraînement pour les sports d'endurance. Il couvre 5 disciplines majeures et applique les meilleures pratiques scientifiques de l'entraînement cardiovasculaire.

### Disciplines Couvertes

1. **Course à pied** (Running): Route, trail, piste
2. **Cyclisme** (Cycling): Route, VTT, gravel, home trainer
3. **Natation** (Swimming): Piscine, eau libre
4. **Triathlon**: Enchaînements multi-sports, transitions
5. **Cardio général**: Développement cardiovasculaire global

---

## Zones d'Entraînement

### Calcul FCMax

**Formule utilisée:** FCMax = 220 - âge

Cette formule théorique est simple et fiable pour la majorité des utilisateurs. Pour un utilisateur de 30 ans : FCMax = 190 bpm.

### Les 5 Zones d'Entraînement

#### Zone 1 - Récupération Active (50-60% FCMax)

**Caractéristiques:**
- Intensité: Très facile
- Sensation: Conversation fluide sans effort
- Respiration: Très confortable
- Durée typique: 20-45 minutes

**Utilisation:**
- Récupération entre séances intenses
- Échauffement prolongé
- Amélioration circulation sanguine
- Apprentissage technique

**Exemple:** 30 ans → 95-114 bpm

---

#### Zone 2 - Endurance Fondamentale (60-70% FCMax)

**Caractéristiques:**
- Intensité: Facile
- Sensation: Respiration confortable, conversation possible
- Respiration: Nasale principalement possible
- Durée typique: 45 minutes à 3 heures

**Utilisation:**
- Développement de la base aérobie
- Construction de l'endurance
- 80% du volume total (règle 80/20)
- Long runs, base miles
- Adaptation métabolique

**Exemple:** 30 ans → 114-133 bpm

**Note critique:** Cette zone est la FONDATION de tout entraînement endurance. Elle ne doit JAMAIS être négligée.

---

#### Zone 3 - Tempo/Seuil Aérobie (70-80% FCMax)

**Caractéristiques:**
- Intensité: Modérément difficile
- Sensation: "Comfortably hard"
- Respiration: Conversation courte possible, phrases
- Durée typique: 20-60 minutes

**Utilisation:**
- Développement seuil aérobie
- Endurance intensive
- Tempo runs, steady state
- Sweet spot cycling (88-94% FTP)

**Exemple:** 30 ans → 133-152 bpm

**Erreur courante:** Passer trop de temps en Z3 ("zone grise"). Mieux vaut du Z2 facile ou du Z4-Z5 difficile.

---

#### Zone 4 - Seuil Lactique (80-90% FCMax)

**Caractéristiques:**
- Intensité: Difficile
- Sensation: Conversation impossible
- Respiration: Bouche ouverte, rythme soutenu
- Durée typique: 5-40 minutes (intervalles ou continu)

**Utilisation:**
- Amélioration du seuil lactique
- Puissance soutenue
- Threshold intervals
- FTP work (cycling)
- Allure tempo soutenue

**Exemple:** 30 ans → 152-171 bpm

**Bénéfices:** Augmente la puissance que vous pouvez soutenir longtemps. Clé pour la performance en course.

---

#### Zone 5 - VO2Max (90-100% FCMax)

**Caractéristiques:**
- Intensité: Très difficile à maximale
- Sensation: Insoutenable plus de quelques minutes
- Respiration: Haletante, maximale
- Durée typique: 30 secondes à 8 minutes (intervalles)

**Utilisation:**
- Développement capacité aérobie maximale
- Intervals courts haute intensité
- Sprint work
- Amélioration VO2Max

**Exemple:** 30 ans → 171-190 bpm

**Format recommandé:** Intervalles structurés avec repos suffisant (ratio 1:1 minimum).

---

## Principe 80/20 - La Règle d'Or

### Concept

**80% du volume total en Zone 1-2 (facile)**
**20% du volume total en Zone 3-5 (difficile)**

### Pourquoi c'est important

1. **Développement aérobie:** La base aérobie se construit en Z1-Z2
2. **Récupération:** Le volume facile permet d'absorber plus de charge totale
3. **Prévention blessures:** Réduit le risque de surmenage
4. **Performance:** Les athlètes élites suivent ce principe rigoureusement

### Répartition par niveau

- **Débutant:** 90/10 (encore plus de facile)
- **Intermédiaire:** 80/20 (standard)
- **Avancé:** 80/20 (plus de volume total)
- **Élite:** 75/25 (volume élevé + intensité structurée)

### Erreur #1 à éviter

**Zone grise excessive:** Trop de Z3 (tempo modéré) épuise sans bénéfices maximaux.

**Solution:** Polariser → Très facile (Z1-Z2) OU très dur (Z4-Z5). Pas entre les deux.

---

## Types de Séances par Discipline

### Course à Pied (Running)

#### 1. Easy Run / Récupération
- **Zones:** Z1-Z2
- **Durée:** 30-60 minutes
- **Objectif:** Récupération active, développement base
- **Sensation:** Test conversation fluide
- **TSS estimé:** 40-50

#### 2. Long Run / Sortie Longue
- **Zones:** Z2
- **Durée:** 60-180 minutes
- **Objectif:** Capacité aérobie, endurance musculaire
- **Progression:** +10-15% distance max par semaine
- **TSS estimé:** 100-150
- **Note:** Nutrition/hydratation critique > 90min

#### 3. Tempo Run / Allure Soutenue
- **Zones:** Z3-Z4
- **Durée:** 20-40 minutes continu
- **Objectif:** Seuil aérobie, endurance à allure course
- **Format:** 10min échauffement + 25min tempo + 10min retour calme
- **TSS estimé:** 60-75

#### 4. Threshold Intervals / Seuil Lactique
- **Zones:** Z4
- **Format:** 4-6 × 5min avec 2min récupération
- **Objectif:** Amélioration seuil, puissance soutenue
- **Progression:** Volume puis intensité
- **TSS estimé:** 75-90

#### 5. VO2Max Intervals
- **Zones:** Z5
- **Format:** 5-8 × 3min avec 2-3min récupération
- **Objectif:** Capacité aérobie maximale
- **TSS estimé:** 85-100
- **Note:** Dur mais essentiel pour progression

#### 6. Fartlek / Jeu d'Allures
- **Zones:** Mix Z2-Z4-Z5
- **Format:** Variations spontanées ou structurées
- **Exemple:** 40min avec 10 × (1min rapide / 2min facile)
- **Objectif:** Adaptabilité, ludique
- **TSS estimé:** 65-80

#### 7. Hill Repeats / Côtes
- **Zones:** Z4-Z5
- **Format:** 8-12 × 60-90s montée forte + descente récup
- **Objectif:** Force spécifique, puissance jambes
- **TSS estimé:** 70-85

---

### Cyclisme (Cycling)

#### 1. Recovery Ride / Récupération
- **Zones:** Z1
- **Durée:** 30-60 minutes
- **Cadence:** 85-95 RPM, braquet léger
- **Objectif:** Récupération active, jambes
- **TSS estimé:** 25-35

#### 2. Endurance Ride / Base Miles
- **Zones:** Z2
- **Durée:** 60-240 minutes
- **Cadence:** 80-90 RPM optimale
- **Objectif:** Base aérobie, efficience pédalage
- **TSS estimé:** 80-150
- **Note:** Nutrition critique sur longues sorties

#### 3. Sweet Spot / Zone Optimale
- **Zones:** 88-94% FTP (entre Z3-Z4)
- **Format:** 2-3 × 20min avec 5-10min récup
- **Objectif:** Seuil sans fatigue excessive
- **TSS estimé:** 75-95
- **Avantage:** Meilleur rapport bénéfice/fatigue

#### 4. Threshold / Seuil FTP
- **Zones:** Z4 (FTP)
- **Format:** 2 × 20min @ FTP avec 10min récup
- **Objectif:** Puissance au seuil lactique
- **TSS estimé:** 85-100
- **Note:** Base du test FTP classique

#### 5. VO2Max Intervals
- **Zones:** Z5 (105-120% FTP)
- **Format:** 5-8 × 3min @ 110% FTP avec 3min récup
- **Cadence:** 95-105 RPM haute
- **Objectif:** Capacité maximale
- **TSS estimé:** 90-110

#### 6. Sprints / Puissance Maximale
- **Zones:** Maximal
- **Format:** 6-10 × 15s sprint avec 3-5min récup complète
- **Objectif:** Puissance neuromusculaire
- **TSS estimé:** 60-75

---

### Natation (Swimming)

#### 1. Technique Drills / Éducatifs
- **Zones:** Z1-Z2
- **Format:** Catch-up, fists, single arm, 6-kick switch
- **Durée:** 30-60 minutes
- **Objectif:** Coordination, efficience
- **TSS estimé:** 35-45

#### 2. Endurance Swim / Nage Continue
- **Zones:** Z2
- **Distance:** 1000-3000m continu
- **Objectif:** Technique sous fatigue, aérobie
- **TSS estimé:** 55-75

#### 3. CSS (Critical Swim Speed) / Seuil
- **Zones:** Z3-Z4
- **Test:** 400m + 200m avec 5min repos
- **CSS = distance totale / temps total**
- **Entraînement:** Intervals au CSS
- **TSS estimé:** 65-85

#### 4. Interval Sets / Séries
- **Zones:** Z4-Z5
- **Format:** 10 × 100m @ CSS+5s avec 20s repos
- **Variations:** 200m, 50m, pyramides
- **Objectif:** Puissance et vitesse
- **TSS estimé:** 70-90

#### 5. Sprint Work / Vitesse
- **Zones:** Z5
- **Format:** 8 × 25m sprint avec 45s repos
- **Objectif:** Technique explosive, puissance
- **TSS estimé:** 60-80

---

### Triathlon (Multi-Sport)

#### 1. Brick Workouts / Enchaînements
- **Format:** Vélo → Course immédiatement
- **Exemple:** 60min vélo Z3 + 20min course Z3
- **Objectif:** Habituer transition T2, jambes lourdes
- **TSS estimé:** 85-105

#### 2. Transition Practice / T1 & T2
- **Focus:** Chronométrer, optimiser, automatiser
- **Inclure:** Changement équipement complet
- **Objectif:** Gagner secondes précieuses en course

#### 3. Multi-Sport Sessions / Combinées
- **Format:** 2 ou 3 disciplines même séance
- **Exemple:** 30min nage + 60min vélo + 20min course
- **Objectif:** Gestion fatigue cumulée
- **TSS estimé:** 120-160

---

## Training Stress Score (TSS)

### Concept

Le TSS quantifie la charge d'entraînement d'une séance. Il prend en compte durée ET intensité.

### Formule

```
TSS = (durée_heures × IF² × 100)
IF (Intensity Factor) = Intensité_moyenne / Seuil
```

### Exemples TSS typiques

- **Easy run 60min Z2:** 40-50 TSS
- **Tempo 45min Z3-Z4:** 60-75 TSS
- **Intervals durs 60min:** 80-100 TSS
- **Long run 2h Z2:** 120-150 TSS

### Estimation par zone

- **Z1:** ~30 TSS/heure
- **Z2:** ~50 TSS/heure
- **Z3:** ~70 TSS/heure
- **Z4:** ~90 TSS/heure
- **Z5:** ~120 TSS/heure

---

## CTL / ATL / TSB - Gestion de la Forme

### CTL (Chronic Training Load) - Forme

- **Définition:** Fitness cumulé sur 42 jours
- **Représente:** Votre capacité d'entraînement actuelle
- **Calcul:** Moyenne pondérée exponentielle TSS (42j)
- **Objectif:** Augmenter progressivement

### ATL (Acute Training Load) - Fatigue

- **Définition:** Charge récente sur 7 jours
- **Représente:** Fatigue accumulée court terme
- **Calcul:** Moyenne pondérée exponentielle TSS (7j)
- **Objectif:** Gérer pour éviter surmenage

### TSB (Training Stress Balance) - Fraîcheur

- **Formule:** TSB = CTL - ATL
- **Interprétation:**
  - **> +25:** Frais (peut-être trop reposé)
  - **+5 à +25:** Optimal (forme + fraîcheur)
  - **-10 à +5:** Fatigué (charge importante récente)
  - **< -10:** Surcharge (risque surmenage)

### Utilisation pratique

**Planification course:**
- 2 semaines avant: TSB = -10 à 0 (pic entraînement)
- 1 semaine avant: TSB = +5 à +15 (affûtage)
- Jour J: TSB = +15 à +25 (frais et affûté)

**Progression:**
- Augmenter CTL de 5-8 TSS/semaine maximum
- Si TSB < -15 pendant plusieurs jours: repos

---

## Progression par Niveau

### Débutant (< 6 mois)

**Volume:**
- +10% maximum par semaine
- Semaine de récupération tous les 3-4 semaines

**Intensité:**
- 90% Z1-Z2, 10% Z3+
- Focus régularité avant intensité

**Fréquence:**
- 3-4 séances/semaine

**Progression:**
- Volume avant intensité
- Construire habitude durable

**TSS hebdomadaire:**
- Début: 150-250 TSS
- Après 3 mois: 250-400 TSS

---

### Intermédiaire (6 mois - 2 ans)

**Volume:**
- Stable ou +5-10% par semaine max
- Semaine récup tous les 3 semaines

**Intensité:**
- 80% Z1-Z2, 20% Z3+
- 1-2 séances qualité/semaine

**Fréquence:**
- 4-6 séances/semaine

**Structure:**
- Blocs de 3 semaines progression + 1 récup
- Introduire périodisation

**TSS hebdomadaire:**
- 400-700 TSS

---

### Avancé (2-5 ans)

**Volume:**
- Stable, optimisé
- Périodisation fine

**Intensité:**
- 75-80% Z1-Z2, 20-25% Z3+
- 2-3 séances qualité/semaine

**Fréquence:**
- 6-10 séances/semaine

**Structure:**
- Blocs spécifiques (Base, Build, Peak)
- Double days possibles

**TSS hebdomadaire:**
- 600-1000+ TSS

---

### Élite (5+ ans)

**Volume:**
- Très élevé, individualisé
- Récupération optimale critique

**Intensité:**
- Polarisée stricte
- 3-4+ séances qualité/semaine

**Fréquence:**
- 10-14+ séances/semaine

**Structure:**
- Périodisation complexe multi-pics
- Suivi scientifique (lactate, VO2Max)

**TSS hebdomadaire:**
- 800-1500+ TSS

---

## Périodisation Endurance

### Phase 1: BASE (8-16 semaines)

**Objectif:** Construire capacité aérobie

**Volume:** +10% max par semaine

**Intensité:** 85-90% en Z1-Z2, 10-15% en Z3+

**Séances types:**
- Long runs/rides
- Base miles volume
- Technique

**TSS cible:** Progressif 300 → 600+ TSS/semaine

---

### Phase 2: BUILD (6-12 semaines)

**Objectif:** Développer puissance et vitesse

**Volume:** Maintenu ou légère progression

**Intensité:** 75-80% en Z1-Z2, 20-25% en Z3+

**Séances types:**
- Threshold intervals
- Tempo runs
- Sweet spot
- VO2Max work

**TSS cible:** Stable 500-800 TSS/semaine

---

### Phase 3: PEAK (2-4 semaines)

**Objectif:** Affûtage pour objectif

**Volume:** -20 à -40% du pic

**Intensité:** Maintenue voire augmentée

**Séances types:**
- Intervals courts intenses
- Technique
- Maintien spécificité

**TSS cible:** 300-500 TSS/semaine (réduit)

---

### Phase 4: RECOVERY (1-2 semaines)

**Objectif:** Régénération complète

**Volume:** -50 à -70% du pic

**Intensité:** 100% en Z1-Z2

**Séances types:**
- Recovery runs
- Nage technique
- Vélo facile

**TSS cible:** 150-300 TSS/semaine

---

## Équipements et Environnements

### Running
- Chaussures route / trail
- Montre GPS avec cardio
- Piste d'athlétisme
- Tapis de course

### Cycling
- Vélo route / VTT / gravel
- Home trainer connecté
- Capteur puissance
- Capteur cadence

### Swimming
- Piscine 25m / 50m
- Eau libre
- Pull buoy, plaquettes, palmes

### Triathlon
- Combinaison néoprène
- Équipement transition
- Vélo triathlon/CLM

---

## Métriques Clés

### Running
- **Pace:** min/km
- **Heart Rate:** bpm
- **Cadence:** pas/min (optimal 170-180)
- **Distance:** km hebdomadaire

### Cycling
- **Power:** watts
- **FTP:** Functional Threshold Power
- **Heart Rate:** bpm
- **Cadence:** RPM (optimal 80-95)
- **TSS:** Training Stress Score

### Swimming
- **Pace:** temps/100m
- **CSS:** Critical Swim Speed
- **Stroke Count:** coups/longueur
- **SWOLF:** Temps + strokes (efficience)

---

## Nutrition et Hydratation

**Avant (2-3h):**
- Glucides pour réserves glycogène
- Éviter fibres et graisses lourdes

**Pendant (> 90min):**
- 30-60g glucides/heure
- 400-800ml eau/heure
- Électrolytes si chaleur

**Après (< 30min):**
- Protéines + glucides
- Ratio 3:1 ou 4:1 glucides:protéines
- Réhydratation complète

---

## Sécurité et Prévention

1. **Échauffement dynamique:** 5-15 minutes progressif TOUJOURS
2. **Cooldown:** 5-10 minutes Z1 retour calme
3. **Règle des 10%:** Ne jamais augmenter volume > 10%/semaine
4. **Recovery:** Minimum 1 jour facile entre séances dures
5. **Écoute du corps:** Douleur ≠ fatigue normale
6. **Signes surmenage:** Fatigue chronique, performances baisse, moral bas

---

## Intégration Technique

### Edge Function
- **Nom:** training-coach-endurance
- **Modèle IA:** GPT-5-mini
- **Endpoint:** /functions/v1/training-coach-endurance

### Service Integration
- **Router:** trainingGenerationService.ts
- **Détermine coach:** Basé sur training type (running, cycling, swimming, triathlon, cardio)
- **Appel:** Automatique selon profil utilisateur

### Caching System
- **Table:** training_ai_cache
- **TTL:** 6 heures pour prescriptions
- **Pattern critique:** Toujours utiliser `{ onConflict: "cache_key" }` dans upsert
- **Fallback:** Continue la génération même si cache échoue
- **Monitoring:** Erreurs loggées dans cache_errors_log

**Exemple de code correct:**
```typescript
const cacheEntry = {
  cache_key: cacheKey,
  user_id: userId,
  cache_type: "prescription",
  cached_data: prescription,
  expires_at: cacheExpiry.toISOString(),
  metadata: { /* ... */ }
};

// CRITIQUE: Le paramètre { onConflict: "cache_key" } est OBLIGATOIRE
const { error } = await supabase
  .from("training_ai_cache")
  .upsert(cacheEntry, { onConflict: "cache_key" });
```

### Error Monitoring
- **Table:** cache_errors_log
- **Rétention:** 30 jours
- **Vue:** cache_errors_summary (agrégation 7 derniers jours)
- **Usage:** Détecter patterns de défaillance cache

### Progression Service
- **Fichier:** enduranceProgressionService.ts
- **Fonctions:** CTL/ATL/TSB, TSS, progressions

### Exercises Database
- **Fichier:** enduranceExercises.ts
- **Contenu:** 20+ workouts structurés par discipline

---

## Version et Maintenance

**Version actuelle:** 1.0.0
**Dernière mise à jour:** October 2025
**Statut:** Production Ready
**Prochaine review:** Post feedback utilisateurs

---

**Maintenu par:** TwinForge AI Team
